<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sohbet Uygulaması</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #chat-box { width: 100%; height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
        .message { margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .message img { max-width: 200px; }
        #message-input { width: 80%; padding: 10px; }
        #send-button { padding: 10px; }
        #image-input { margin-top: 10px; }
        .heart { cursor: pointer; color: red; }
    </style>
</head>
<body>

<h2>Sohbet Uygulaması</h2>
<div id="chat-box"></div>
<input type="text" id="message-input" placeholder="Mesajınızı yazın...">
<button id="send-button">Gönder</button>

<!-- Fotoğraf yükleme -->
<input type="file" id="image-input">
<button id="upload-button">Fotoğraf Yükle</button>

<!-- Firebase SDK'larını dahil et -->
<script type="module">
    // Import Firebase ve gerekli fonksiyonları
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js";

    // Firebase konfigürasyon bilgilerini buraya ekle
    const firebaseConfig = {
      apiKey: "AIzaSyDTw5-unWMTSxi2YXVkN6bK_RWTw9gBPm4",
      authDomain: "outlowe-363b4.firebaseapp.com",
      projectId: "outlowe-363b4",
      storageBucket: "outlowe-363b4.firebasestorage.app",
      messagingSenderId: "1073764235290",
      appId: "1:1073764235290:web:9500f6c8186f9615e579a3",
      measurementId: "G-PT2E0T3B6K"
    };

    // Firebase'i başlat
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const storage = getStorage(app);

    // HTML öğelerini seç
    const chatBox = document.getElementById("chat-box");
    const messageInput = document.getElementById("message-input");
    const sendButton = document.getElementById("send-button");
    const imageInput = document.getElementById("image-input");
    const uploadButton = document.getElementById("upload-button");

    // Mesaj gönderme fonksiyonu
    sendButton.onclick = function() {
        const message = messageInput.value.trim();
        if (message) {
            const messagesRef = ref(database, 'messages');
            const newMessageRef = push(messagesRef);
            newMessageRef.set({
                text: message,
                imageUrl: null,
                heartCount: 0,
                timestamp: Date.now()
            });
            messageInput.value = '';  // Mesaj kutusunu temizle
        }
    };

    // Fotoğraf yükleme fonksiyonu
    uploadButton.addEventListener("click", () => {
        const file = imageInput.files[0];
        if (file) {
            const storageRef = storageRef(storage, 'images/' + file.name);
            uploadBytes(storageRef, file).then((snapshot) => {
                getDownloadURL(snapshot.ref).then((downloadURL) => {
                    const messagesRef = ref(database, 'messages');
                    const newMessageRef = push(messagesRef);
                    newMessageRef.set({
                        text: "Bir fotoğraf paylaşıldı",
                        imageUrl: downloadURL,
                        heartCount: 0,
                        timestamp: Date.now()
                    });
                });
            });
        }
    });

    // Mesajları Firebase'ten al ve sayfada göster
    const messagesRef = ref(database, 'messages');
    onChildAdded(messagesRef, function(snapshot) {
        const message = snapshot.val();
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message");
        
        // Mesaj metni
        const textDiv = document.createElement("div");
        textDiv.textContent = message.text;
        messageDiv.appendChild(textDiv);

        // Fotoğraf URL'si varsa fotoğrafı göster
        if (message.imageUrl) {
            const image = document.createElement("img");
            image.src = message.imageUrl;
            messageDiv.appendChild(image);
        }

        // Kalp butonu ve sayacı
        const heartButton = document.createElement("span");
        heartButton.textContent = "❤️ " + message.heartCount;
        heartButton.classList.add("heart");
        heartButton.addEventListener("click", () => {
            // Kalp tıklandığında sayacı artır
            const messageRef = ref(database, 'messages/' + snapshot.key);
            messageRef.update({
                heartCount: message.heartCount + 1
            });
        });
        messageDiv.appendChild(heartButton);

        // Yorum kısmı
        const commentInput = document.createElement("input");
        commentInput.placeholder = "Yorum yaz...";
        const commentButton = document.createElement("button");
        commentButton.textContent = "Yorum Yap";
        
        commentButton.addEventListener("click", () => {
            const comment = commentInput.value.trim();
            if (comment) {
                const commentsRef = ref(database, 'messages/' + snapshot.key + '/comments');
                const newCommentRef = push(commentsRef);
                newCommentRef.set({
                    text: comment,
                    timestamp: Date.now()
                });
                commentInput.value = '';  // Yorum kutusunu temizle
            }
        });

        messageDiv.appendChild(commentInput);
        messageDiv.appendChild(commentButton);

        // Yorumları yükle
        const commentsRef = ref(database, 'messages/' + snapshot.key + '/comments');
        onChildAdded(commentsRef, function(commentSnapshot) {
            const comment = commentSnapshot.val();
            const commentDiv = document.createElement("div");
            commentDiv.textContent = comment.text;
            messageDiv.appendChild(commentDiv);
        });

        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;  // Sohbeti en alta kaydır
    });
</script>

</body>
</html>
