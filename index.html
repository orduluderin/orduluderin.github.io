<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fotoğraf ve Yorum Sistemi</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #photo-gallery { display: flex; flex-wrap: wrap; gap: 20px; }
        .photo { width: 200px; border: 1px solid #ddd; padding: 10px; text-align: center; }
        .photo img { width: 100%; height: 150px; object-fit: cover; }
        .comments { margin-top: 10px; }
        .comment { background-color: #f0f0f0; padding: 5px; margin: 5px 0; border-radius: 5px; }
        input[type="file"] { margin-top: 10px; }
        #upload-button { margin-top: 10px; }
        #comment-input { width: 100%; padding: 5px; }
        #comment-button { margin-top: 5px; padding: 5px 10px; }
    </style>
</head>
<body>

<h2>Fotoğraf ve Yorum Sistemi</h2>

<!-- Fotoğraf yükleme alanı -->
<input type="file" id="image-input">
<button id="upload-button">Fotoğraf Yükle</button>

<!-- Fotoğraf galerisi -->
<div id="photo-gallery"></div>

<!-- Yorum eklemek için alan -->
<input type="text" id="comment-input" placeholder="Yorum yapın...">
<button id="comment-button">Yorum Yap</button>

<!-- Firebase SDK'larını dahil et -->
<script type="module">
    // Firebase'i ve gerekli modülleri içe aktar
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js";

    // Firebase yapılandırma bilgileri
    const firebaseConfig = {
      apiKey: "AIzaSyDTw5-unWMTSxi2YXVkN6bK_RWTw9gBPm4",
      authDomain: "outlowe-363b4.firebaseapp.com",
      projectId: "outlowe-363b4",
      storageBucket: "outlowe-363b4.firebasestorage.app",
      messagingSenderId: "1073764235290",
      appId: "1:1073764235290:web:9500f6c8186f9615e579a3",
      measurementId: "G-PT2E0T3B6K"
    };

    // Firebase'i başlat
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const storage = getStorage(app);

    // HTML elemanlarını seç
    const imageInput = document.getElementById("image-input");
    const uploadButton = document.getElementById("upload-button");
    const photoGallery = document.getElementById("photo-gallery");
    const commentInput = document.getElementById("comment-input");
    const commentButton = document.getElementById("comment-button");

    // Fotoğraf yükleme
    uploadButton.addEventListener("click", () => {
        const file = imageInput.files[0];
        if (file) {
            const storageReference = storageRef(storage, 'photos/' + file.name);
            uploadBytes(storageReference, file).then((snapshot) => {
                console.log("Fotoğraf yüklendi!");
                getDownloadURL(snapshot.ref).then((downloadURL) => {
                    const photosRef = ref(database, 'photos');
                    const newPhotoRef = push(photosRef);
                    newPhotoRef.set({
                        imageUrl: downloadURL,
                        timestamp: Date.now()
                    });
                    imageInput.value = ''; // Dosya inputu temizle
                });
            }).catch((error) => {
                console.error("Fotoğraf yüklenirken hata oluştu: ", error);
            });
        }
    });

    // Yorum gönderme
    commentButton.addEventListener("click", () => {
        const comment = commentInput.value.trim();
        if (comment) {
            const photoId = commentButton.getAttribute('data-photo-id');
            const commentsRef = ref(database, 'photos/' + photoId + '/comments');
            const newCommentRef = push(commentsRef);
            newCommentRef.set({
                text: comment,
                timestamp: Date.now()
            });
            commentInput.value = ''; // Yorum kutusunu temizle
        }
    });

    // Firebase'den fotoğrafları al ve galeriyi oluştur
    const photosRef = ref(database, 'photos');
    onChildAdded(photosRef, function(snapshot) {
        const photo = snapshot.val();
        const photoDiv = document.createElement("div");
        photoDiv.classList.add("photo");
        
        // Fotoğrafı ekle
        const img = document.createElement("img");
        img.src = photo.imageUrl;
        photoDiv.appendChild(img);

        // Yorumları ekle
        const commentsDiv = document.createElement("div");
        commentsDiv.classList.add("comments");

        const commentsRef = ref(database, 'photos/' + snapshot.key + '/comments');
        onChildAdded(commentsRef, function(commentSnapshot) {
            const comment = commentSnapshot.val();
            const commentDiv = document.createElement("div");
            commentDiv.classList.add("comment");
            commentDiv.textContent = comment.text;
            commentsDiv.appendChild(commentDiv);
        });

        // Fotoğraf ve yorumları galeride göster
        photoDiv.appendChild(commentsDiv);
        photoGallery.appendChild(photoDiv);

        // Yorum yapmak için buton ekle
        const commentButton = document.createElement("button");
        commentButton.textContent = "Yorum Yap";
        commentButton.setAttribute('data-photo-id', snapshot.key);
        photoDiv.appendChild(commentButton);
    });

</script>

</body>
</html>
